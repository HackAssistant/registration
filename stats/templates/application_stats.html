{% extends 'c3_base.html' %}

{% block head_title %}Application stats{% endblock %}
{% block panel %}
    <h1>Application stats</h1>
    <small class="pull-right"><b>Last updated:</b> <span id="update_date"></span></small>
    <div class="row">
        <div class="col-md-12">
            <div id="timeseries">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <h3>Status</h3>
            <div id="applications_stats"></div>
            <p><b>Application count:</b> <span id="app_count"></span></p>
        </div>
        <div class="col-md-6">
            <h3>Gender</h3>
            <div id="gender_stats"></div>
        </div>
    </div>
    <h2>Origin</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="origin_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="origin_stats_confirmed"></div>
        </div>
    </div>
    <h2>University</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="university_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="university_stats_confirmed"></div>
        </div>
    </div>
    <h2>Graduation year</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="graduation_year_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="graduation_year_stats_confirmed"></div>
        </div>
    </div>
    <h2>Degree</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="degree_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="degree_stats_confirmed"></div>
        </div>
    </div>
  <h2>First timer</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="first_timer_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="first_timer_stats_confirmed"></div>
        </div>
    </div>
    <h2>T-Shirts sizes</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="shirts_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="shirts_stats_confirmed"></div>
        </div>
    </div>
    <h2>Dietary restrictions</h2>

    <div class="row">
        <div class="col-md-6">
            <h3>All</h3>
            <div id="diet_stats"></div>
        </div>
        <div class="col-md-6">
            <h3>Confirmed only</h3>
            <div id="diet_stats_confirmed"></div>
        </div>
        <div class="col-md-12">
            <p><b>Confirmed extra diet requirements:</b><br> <span id="other_diet"></span></p>
        </div>

    </div>


{% endblock %}
{% block c3script %}
    <script>
        $.getJSON('{% url 'api_app_stats' %}', function (data) {
            c3.generate({
                bindto: '#timeseries',
                data: {
                    json: data['timeseries'],
                    keys: {
                        x: 'date',
                        value: ['applications']
                    }
                },

                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: '%Y-%m-%d'
                        }
                    }
                }
            });
            c3.generate({
                bindto: '#shirts_stats_confirmed',
                data: {
                    json: data['shirt_count_confirmed'],
                    keys: {
                        x: 'tshirt_size',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });

            var status_data = {};
            var sites = [];
            $(data['status']).each(function (c, e) {
                sites.push(e.status_name);
                status_data[e.status_name] = e.applications;
            });
            c3.generate({
                bindto: '#applications_stats',
                data: {
                    json: status_data,
                    type: 'donut'

                },
                donut: {
                    label: {
                        format: function (value, ratio, id) {
                            return value;
                        }
                    }
                }
            });
            var gender_data = {};
            var genders = [];
            $(data['gender']).each(function (c, e) {
                genders.push(e.gender_name);
                gender_data[e.gender_name] = e.applications;
            });
            c3.generate({
                bindto: '#gender_stats',
                data: {
                    json: gender_data,
                    type: 'donut'

                },
                donut: {
                    label: {
                        format: function (value, ratio, id) {
                            return value;
                        }
                    }
                }
            });
            c3.generate({
                bindto: '#shirts_stats',
                data: {
                    json: data['shirt_count'],
                    keys: {
                        x: 'tshirt_size',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#diet_stats',
                data: {
                    json: data['diet'],
                    keys: {
                        x: 'diet',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#diet_stats_confirmed',
                data: {
                    json: data['diet_confirmed'],
                    keys: {
                        x: 'diet',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#origin_stats',
                data: {
                    json: data['origin'],
                    keys: {
                        x: 'origin',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#origin_stats_confirmed',
                data: {
                    json: data['origin_confirmed'],
                    keys: {
                        x: 'origin',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#university_stats',
                data: {
                    json: data['university'],
                    keys: {
                        x: 'university',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#university_stats_confirmed',
                data: {
                    json: data['university_confirmed'],
                    keys: {
                        x: 'university',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            var grad_year_data = {};
            var grad_years = [];
            $(data['graduation_year']).each(function (c, e) {
                grad_years.push(e.graduation_year);
                grad_year_data[e.graduation_year] = e.applications;
            });
            c3.generate({
                bindto: '#graduation_year_stats',
                data: {
                    json: grad_year_data,
                    type: 'donut'

                },
                donut: {
                    label: {
                        format: function (value, ratio, id) {
                            return value;
                        }
                    }
                }
            });
            var grad_year_confirmed_data = {};
            var grad_years_confirmed = [];
            $(data['graduation_year_confirmed']).each(function (c, e) {
                grad_years_confirmed.push(e.graduation_year);
                grad_year_confirmed_data[e.graduation_year] = e.applications;
            });
            c3.generate({
                bindto: '#graduation_year_stats_confirmed',
                data: {
                    json: grad_year_confirmed_data,
                    type: 'donut'

                },
                donut: {
                    label: {
                        format: function (value, ratio, id) {
                            return value;
                        }
                    }
                }
            });
            c3.generate({
                bindto: '#degree_stats',
                data: {
                    json: data['degree'],
                    keys: {
                        x: 'degree',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            c3.generate({
                bindto: '#degree_stats_confirmed',
                data: {
                    json: data['degree_confirmed'],
                    keys: {
                        x: 'degree',
                        value: ['applications']
                    },
                    type: 'bar'

                },

                axis: {
                    x: {
                        type: 'category'
                    }
                }
            });
            var first_timer_data = {};
            var first_timers = [];
            $(data['first_timer']).each(function (c, e) {
                first_timers.push(e.first_timer);
                first_timer_data[e.first_timer] = e.applications;
            });
            c3.generate({
                bindto: '#first_timer_stats',
                data: {
                    json: first_timer_data,
                    type: 'donut'

                },
                donut: {
                    label: {
                        format: function (value, ratio, id) {
                            return value;
                        }
                    }
                }
            });
            var first_timer_confirmed_data = {};
            var first_timers_confirmed = [];
            $(data['first_timer_confirmed']).each(function (c, e) {
                first_timers_confirmed.push(e.first_timer);
                first_timer_confirmed_data[e.first_timer] = e.applications;
            });
            c3.generate({
                bindto: '#first_timer_stats_confirmed',
                data: {
                    json: first_timer_confirmed_data,
                    type: 'donut'

                },
                donut: {
                    label: {
                        format: function (value, ratio, id) {
                            return value;
                        }
                    }
                }
            });
            $('#other_diet').html(data['other_diet']);
            $('#update_date').html(data['update_time']);
            $('#app_count').html(data['app_count']);
        })
        ;

    </script>
{% endblock %}
